<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Settings â€” GraceWise</title>
<link rel="stylesheet" href="/theme.css">
<script src="/core.js"></script>
</head>

<body>
  <div class="header">
    <div style="display:flex;gap:12px;align-items:center">
      <div class="logo">GW</div>
      <div>
        <div style="font-weight:700;font-size:18px">GraceWise</div>
        <div class="small">Settings</div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="panel">
      <h3>Settings</h3>
      <div class="small">Backup, restore, theme, and export.</div>

      <label>Theme
        <select id="themeSelect">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </label>

      <div style="margin-top:10px;display:flex;flex-wrap:wrap;gap:8px">
        <button id="syncBtn">Backup to Cloud</button>
        <button id="restoreBtn">Restore from Cloud</button>
        <button id="downloadBtn">Download Data File</button>
      </div>

      <div style="margin-top:15px;text-align:center;">
        <button id="logoutBtn" style="
          background: linear-gradient(90deg, #F37021, #005BAC);
          color: #fff;
          border: none;
          border-radius: 6px;
          padding: 10px 14px;
          font-weight: 600;
          cursor: pointer;
          min-width: 120px;
        ">Logout</button>
      </div>

      <div id="syncStatus" class="small" style="margin-top:10px;"></div>
    </div>
  </div>

  <!-- Bottom navigation -->
  <div class="bottom-nav">
    <div class="nav-item" data-path="/cards.html" onclick="location.href='/cards.html'">Cards</div>
    <div class="nav-item" data-path="/transactions.html" onclick="location.href='/transactions.html'">Transactions</div>
    <div class="nav-item" data-path="/grace.html" onclick="location.href='/grace.html'">Grace</div>
    <div class="nav-item active" data-path="/settings.html" onclick="location.href='/settings.html'">Settings</div>
  </div>

  <script>
  // --- Initialization ---
  applyTheme();
  setActiveNav('/settings.html');

  // --- Theme handling ---
  const sel = document.getElementById('themeSelect');
  sel.value = localStorage.getItem(THEME_KEY()) || 'light';
  sel.addEventListener('change', e => {
    localStorage.setItem(THEME_KEY(), e.target.value);
    applyTheme();
  });

  // --- Cloud Sync ---
  document.getElementById('syncBtn').addEventListener('click', async () => {
    document.getElementById('syncStatus').textContent = 'Syncing...';
    const r = await syncToServer();
    document.getElementById('syncStatus').textContent = r && r.ok ? 'Backup saved' : 'Backup failed';
  });

  document.getElementById('restoreBtn').addEventListener('click', async () => {
    document.getElementById('syncStatus').textContent = 'Restoring...';
    const r = await restoreFromServer();
    document.getElementById('syncStatus').textContent = r && r.ok ? 'Restored' : 'Restore failed';
    if (r && r.ok) location.reload();
  });

  document.getElementById('downloadBtn').addEventListener('click', () => {
    downloadDataFile();
  });

  // --- Logout ---
  document.getElementById('logoutBtn').addEventListener('click', () => {
    if (confirm('Are you sure you want to log out?')) {
      localStorage.removeItem('gw_user');
      localStorage.removeItem('theme');
      localStorage.removeItem('gw_tx_guest');
      localStorage.removeItem('gw_banks_guest');
      document.body.innerHTML = '<div style="font-size:22px;text-align:center;margin-top:40vh;color:#F37021;">Logging out...</div>';
      setTimeout(() => window.location.href = '/login.html', 1000);
    }
  });
  </script>
</body>
</html>
