<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GraceWise v5 Safe Mode</title>
<style>
:root{--cib-blue:#005BAC;--cib-orange:#F37021;}
body{font-family:sans-serif;margin:0;background:#f7f9fb;color:#111}
#splash{position:fixed;inset:0;background:linear-gradient(90deg,var(--cib-blue),var(--cib-orange));display:flex;flex-direction:column;align-items:center;justify-content:center;color:white;transition:opacity .5s ease;z-index:9999}
#splash.hidden{opacity:0;pointer-events:none}
.splash-box{font-size:48px;font-weight:800;padding:24px;border:3px solid rgba(255,255,255,0.3);border-radius:16px}
#app{display:none;padding:16px}
.panel{background:white;padding:12px;margin-bottom:12px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
#errorBox{position:fixed;top:0;left:0;right:0;background:#ff5555;color:white;padding:8px;font-weight:bold;display:none;z-index:10000}
.nav{position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:space-around;background:white;border-top:1px solid #ddd;padding:8px 0}
</style>
</head>
<body>
<div id="errorBox"></div>
<div id="splash"><div class="splash-box">GW</div><div>GraceWise — Safe Mode</div></div>
<div id="app">
  <div class="panel"><h2>Cards / Banks</h2><div id="banksList">Loading...</div></div>
  <div class="panel"><h2>Transactions</h2><div id="txList"></div></div>
  <div class="panel"><h2>Grace Analysis</h2><div id="graceInfo"></div></div>
  <div class="panel"><h2>Insights</h2><div id="insights"></div></div>
  <div class="panel"><h2>Settings</h2><button onclick="localStorage.clear();location.reload()">Clear Data</button></div>
</div>
<div class="nav"><div>Cards</div><div>Tx</div><div>Grace</div><div>Insights</div><div>⚙️</div></div>
<script>
window.onerror=function(msg,src,line,col,err){
  const box=document.getElementById('errorBox');
  box.style.display='block';
  box.textContent='⚠️ JS Error: '+msg+' @ '+line+':'+col;
  console.error('Error caught:',msg,src,line,col,err);
  // ensure app still visible
  document.getElementById('app').style.display='block';
  document.getElementById('splash').classList.add('hidden');
  setTimeout(()=>{document.getElementById('splash').style.display='none';},500);
  return true;
};
// Always show app after 1s even if init fails
window.addEventListener('DOMContentLoaded',()=>{
  setTimeout(()=>{
    const splash=document.getElementById('splash');
    splash.classList.add('hidden');
    setTimeout(()=>{ splash.style.display='none'; document.getElementById('app').style.display='block'; },500);
  },1000);
  try{
    // Simulate app load safely
    initSafe();
  }catch(e){window.onerror(e.message,'safe',0,0,e);}
});
function initSafe(){
  const b=JSON.parse(localStorage.getItem('gw_v4_banks')||'[]');
  const banksList=document.getElementById('banksList');
  if(b.length==0){banksList.innerHTML='<div>No cards found. Safe mode minimal view.</div>';}else{
    banksList.innerHTML=b.map(x=>'<div>'+x.name+'</div>').join('');
  }
  const txs=JSON.parse(localStorage.getItem('gw_v4_tx')||'[]');
  document.getElementById('txList').innerHTML=txs.length+' transactions loaded.';
  document.getElementById('graceInfo').innerHTML='Grace analysis placeholder loaded.';
}
</script>
</body>
</html>