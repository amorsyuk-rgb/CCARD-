<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GraceWise v5 — Smart Credit Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root{--cib-blue:#005BAC;--cib-orange:#F37021;--okx-bg:#0b0f14;--okx-text:#e6eef3;}
*{box-sizing:border-box}body{margin:0;font-family:Inter;background:#f9fafc;color:#111}
.header{background:linear-gradient(90deg,var(--cib-blue),var(--cib-orange));color:white;padding:10px 16px;display:flex;align-items:center;justify-content:space-between}
.logo{font-weight:800;font-size:20px}
.tab-section{display:none;padding:16px}
.tab-section.active{display:block}
.bottom-nav{position:fixed;left:0;right:0;bottom:0;display:flex;justify-content:space-around;height:60px;border-top:1px solid #ddd;background:#fff}
.nav-item{display:flex;align-items:center;gap:6px;cursor:pointer;color:#666;font-weight:600}
.nav-item.active{color:var(--cib-blue)}
.progress-wrap{width:100%;height:10px;background:#e6e6e6;border-radius:6px;margin-top:8px;overflow:hidden}
.progress-bar{height:100%;border-radius:6px;transition:width 0.3s ease}
.dark .progress-wrap{background:#1a1f27}
.dark .progress-bar{background:linear-gradient(90deg,#00a3ff,#9b59b6)}
#splash{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;background:linear-gradient(90deg,var(--cib-blue),var(--cib-orange));color:white;z-index:9999}
.splash-box{font-size:50px;font-weight:800;padding:20px;border:3px solid rgba(255,255,255,0.3);border-radius:16px}
.dark body{background:var(--okx-bg);color:var(--okx-text)}
</style>
</head>
<body>
<div id="splash"><div class="splash-box">GW</div><div>GraceWise — Smart Credit Dashboard</div></div>
<div id="app" style="display:none">
  <div class="header"><div class="logo">GraceWise</div><button id="themeToggle">Theme</button></div>
  <div id="tabGrace" class="tab-section active">
    <h2>Grace Analysis</h2>
    <label>Select Card/Bank<select id="bankSelect"></select></label>
    <label>Purchase Date<input type="date" id="purchaseDate"></label>
    <div id="graceInfo" style="margin-top:12px;border:1px solid #ddd;border-radius:8px;padding:12px"></div>
    <canvas id="weekChart" style="margin-top:20px"></canvas>
  </div>
  <div class="bottom-nav"><div class="nav-item active"><span class="material-icons-outlined">show_chart</span><span>Grace</span></div></div>
</div>
<script>
const THEME_KEY='gw_theme_v5';let theme=localStorage.getItem(THEME_KEY)||'cib';
function applyTheme(){if(theme==='dark'){document.body.classList.add('dark');}else{document.body.classList.remove('dark');}localStorage.setItem(THEME_KEY,theme);}
document.getElementById('themeToggle').onclick=()=>{theme=(theme==='cib'?'dark':'cib');applyTheme();};
window.onload=()=>{setTimeout(()=>{document.getElementById('splash').style.display='none';document.getElementById('app').style.display='block';init();},800);};
function init(){
 applyTheme();
 const banks=JSON.parse(localStorage.getItem('gw_v4_banks')||'[]');
 const sel=document.getElementById('bankSelect');
 if(!banks.length){sel.innerHTML='<option>No cards found</option>';return;}
 banks.forEach(b=>{const opt=document.createElement('option');opt.value=b.id;opt.textContent=b.name;sel.appendChild(opt);});
 document.getElementById('purchaseDate').addEventListener('change',()=>updateGrace());
 sel.addEventListener('change',()=>updateGrace());
}
function daysDiff(a,b){return Math.round((b-a)/(1000*60*60*24));}
function fmt(d){return d.toLocaleDateString();}
function updateGrace(){
 const id=document.getElementById('bankSelect').value;
 const banks=JSON.parse(localStorage.getItem('gw_v4_banks')||'[]');
 const bank=banks.find(x=>x.id===id);if(!bank)return;
 const purchase=new Date(document.getElementById('purchaseDate').value+'T00:00:00');
 const due=new Date(bank.due);
 const graceDays=daysDiff(purchase,due);
 const today=new Date();
 const daysLeft=daysDiff(today,due);
 const graceInfo=document.getElementById('graceInfo');
 let html='<b>Purchase:</b> '+fmt(purchase)+'<br><b>Cycle Ends:</b> '+fmt(new Date(bank.end))+'<br><b>Due:</b> '+fmt(due)+'<br><b>Grace Period:</b> '+graceDays+' days<br>';
 if(daysLeft>=0){html+='<b>Grace window closes in:</b> '+daysLeft+' days<div class="progress-wrap"><div class="progress-bar" id="prog"></div></div>';}else{html+='<b style="color:red">Grace window expired</b><div class="progress-wrap"><div class="progress-bar" id="prog" style="width:100%;background:red"></div></div>';}
 graceInfo.innerHTML=html;
 const percent=Math.min(100,Math.max(0,((graceDays-daysLeft)/graceDays)*100));
 const prog=document.getElementById('prog');if(prog){let color=(theme==='dark')?'linear-gradient(90deg,#00a3ff,#9b59b6)':'linear-gradient(90deg,var(--cib-blue),var(--cib-orange))';prog.style.background=color;prog.style.width=percent+'%';}
 buildWeekChart(bank,due);
}
function buildWeekChart(bank,due){
 const ctx=document.getElementById('weekChart').getContext('2d');
 const today=new Date();const start=new Date(today);start.setDate(today.getDate()-today.getDay());
 const labels=[],data=[];
 for(let i=0;i<7;i++){const d=new Date(start);d.setDate(start.getDate()+i);labels.push(d.toLocaleDateString('en-US',{weekday:'short'}));data.push(daysDiff(d,due));}
 if(window.weekChart)window.weekChart.destroy();
 window.weekChart=new Chart(ctx,{type:'bar',data:{labels:labels,datasets:[{label:'Grace Days',data:data,backgroundColor:labels.map(()=> (theme==='dark')?'#00a3ff':'#005BAC')}]},options:{responsive:true,plugins:{legend:{display:false},title:{display:true,text:'This Week Grace Overview'}}}});
}
</script>
</body></html>